{"componentChunkName":"component---src-templates-chapter-js","path":"/module2","result":{"data":{"site":{"siteMetadata":{"courseId":"neotoma2-workshops"}},"markdownRemark":{"htmlAst":{"type":"root","children":[{"type":"element","tagName":"exercise","properties":{"id":"0","title":"Introduction"},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"iframe","properties":{"src":"https://docs.google.com/presentation/d/e/2PACX-1vTCB947TF8imDLr7lIm6FgoctRuRSkz2nsymFNbp1DglVzCuEQv2iyYZeAoKCfXEhCyzRFvl8Ec3UtK/embed?start=false&loop=false&delayms=3000","frameBorder":"0","width":960,"height":569,"allowFullScreen":"true","mozallowfullscreen":"true","webkitallowfullscreen":"true"},"children":[]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"exercise","properties":{"id":"1","title":"get_sites()"},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{},"children":[{"type":"text","value":"Sites"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"get_sites()"}]},{"type":"text","value":" is the most basic core command to help the user get metadata from a site. "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Check out the most simple usage in action"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"img","properties":{"src":"https://github.com/NeotomaDB/neotoma_workshop/blob/main/static/module2/sites_id.gif?raw=true","alt":"img"},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now, try it out yourself! Change the two __ for your favourite number and run the code!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The first time you run this code, it might take a couple of minutes to get it started."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"codeblock","properties":{"id":"02_01"},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Change the __ for a number"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can also pass a vector with numbers and execute "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"get_sites()"}]},{"type":"text","value":" to obtain multiple records at once:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"img","properties":{"src":"https://github.com/NeotomaDB/neotoma_workshop/blob/main/static/module2/sites_list.gif?raw=true","alt":"img"},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Try it yourself! "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"codeblock","properties":{"id":"02_02"},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Change the __ for a vector of number"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Searching by Name"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can also search for a record by using its name; for this, you need to use the argument "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"sitename="}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can pass an exact name or you can use wildcards "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"%"}]},{"type":"text","value":" for an approximate name."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Remember that a name is a string and so, it must be passed between single "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"'"}]},{"type":"text","value":" or double quotations "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"\""}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"img","properties":{"src":"https://github.com/NeotomaDB/neotoma_workshop/blob/main/static/module2/sites_name.gif?raw=true","alt":"img"},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"codeblock","properties":{"id":"02_03"},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Change the name. Play around with wildcards and see what happens! "}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are other arguments you can use in "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"get_sites()"}]},{"type":"text","value":" such as "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"altmin"}]},{"type":"text","value":" or "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"altmax"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Remember you can combine arguments as well!!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"codeblock","properties":{"id":"02_04"},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Play with different altitudes and sitenames."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{},"children":[{"type":"text","value":"Accessing a site’s metadata"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"sites"}]},{"type":"text","value":" are composed of several smaller objects of class "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"site"}]},{"type":"text","value":".\nWe can call any individual site using "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"[[ ]]"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A single "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"site"}]},{"type":"text","value":" object has a lot of data.  You can access a site’s data using "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"$"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"site[[1]]$siteid"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"img","properties":{"src":"","alt":"gif"},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Some of the fields you can access are:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"markdown"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-markdown"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-markdown"]},"children":[{"type":"text","value":"siteid\nsitename\nlat\nlong\narea\nnotes\ndescription"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Try it out!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"codeblock","properties":{"id":"02_05"},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Play with different altitudes and sitenames."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{},"children":[{"type":"text","value":"Exercise"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Using dplyr and sites attributes, retrieve all ids from a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"sites"}]},{"type":"text","value":" object"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"codeblock","properties":{"id":"02_06"},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Convert a sites object to a dataframe.\nExtract the column of ids"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"exercise","properties":{"id":"2","title":"get_datasets()"},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{},"children":[{"type":"text","value":"Datasets"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you need to get to a deeper level of the sites object, you may want to look at the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"get_datasets()"}]},{"type":"text","value":" function.  You can use "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"get_datasets()"}]},{"type":"text","value":" using search parameters, or you can use it on an existing "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"sites"}]},{"type":"text","value":" object."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"get_datasets()"}]},{"type":"text","value":" adds additional metadata to the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"site"}]},{"type":"text","value":" objects, letting us know which "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"datasettypes"}]},{"type":"text","value":" are associated with a site, and the dataset sample locations at the site."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Getting the datasets by id is the easiest call, you can also pass a vector of IDs or if you already have a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"sites"}]},{"type":"text","value":" object, you can pass a sites object. "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Warning"}]},{"type":"text","value":" "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"get_datasets()"}]},{"type":"text","value":" does not take "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"sitename"}]},{"type":"text","value":" or "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"siteid"}]},{"type":"text","value":" as inputs, if you wish to use those you can chain "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"get_sites()"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"get_datasets()"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# Getting datasets by ID\nmy_datasets <- get_datasets(c(5, 10, 15, 20))\nmy_datasets"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can also retrieve datasets by type directly from the API."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# Getting datasets by type\nmy_pollen_datasets <- get_datasets(datasettype = \"pollen\", limit = 25)\nmy_pollen_datasets"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It can be computationally intensive to obtain the full set of records for "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"sites"}]},{"type":"text","value":" or "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"datasets"}]},{"type":"text","value":". By default the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"limit"}]},{"type":"text","value":" for all queries is "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"25"}]},{"type":"text","value":".  The default "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"offset"}]},{"type":"text","value":" is "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"0"}]},{"type":"text","value":".  To capture all results it is possible to add "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"limit=99999999"}]},{"type":"text","value":" or some similarly high number.  "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"However"}]},{"type":"text","value":", this is hard on the Neotoma servers.  Best practice is to loop through results, using "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"limit"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"offset"}]},{"type":"text","value":", for example, in a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"while"}]},{"type":"text","value":" loop.  In a result set of 100 records, the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"limit"}]},{"type":"text","value":", when "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"offset"}]},{"type":"text","value":" is 0 (the default), ensures that only the first 25 records are returned.  Keeping the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"limit"}]},{"type":"text","value":" at 25, and increasing the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"offset"}]},{"type":"text","value":" to 25 would give us the next 25 records."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can use that in a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"while"}]},{"type":"text","value":" loop in R in the following way:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"run = TRUE\noffset <- 0\nwhile(run) {\n  sites <- get_sites(offset=offset, limit = 500)\n  if(length(sites) == 0) {\n    run = FALSE\n  }\n  if(exists('allSites')) {\n    allSites <- c(allSites, sites)\n  } else {\n    allSites <- sites\n  }\n  offset <- offset + 500\n}"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It can be computationally intensive to obtain the full set of records for "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"sites"}]},{"type":"text","value":" or "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"datasets"}]},{"type":"text","value":". By default the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"limit"}]},{"type":"text","value":" for all queries is "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"25"}]},{"type":"text","value":".  The default "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"offset"}]},{"type":"text","value":" is "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"0"}]},{"type":"text","value":".  To capture all results it is possible to add the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"limit=99999999"}]},{"type":"text","value":" or some similarly high number.  "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"However"}]},{"type":"text","value":", this is hard on the Neotoma servers.  Best practice is to loop through results, you can do that automatically using the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"all_data=TRUE"}]},{"type":"text","value":" argument."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can use that "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"all_data=TRUE"}]},{"type":"text","value":" in R in the following way:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"allSites <- get_sites(all_data = TRUE)\nallSites\n "}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Following this  can see that the total sites returned is equal to the total number of sites in Neotoma."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can get the coordinates to create a GeoJson bounding box from "},{"type":"element","tagName":"a","properties":{"href":"https://geojson.io/#map=2/20.0/0.0"},"children":[{"type":"text","value":"here"}]},{"type":"text","value":", or you can use pre-existing objects within R, for example, country-level data within the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"spData"}]},{"type":"text","value":" package:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Accessing datasets by bounding box:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"brazil <- '{\"type\": \"Polygon\", \n            \"coordinates\": [[\n                [-73.125, -9.102],\n                [-56.953, -33.138],\n                [-36.563, -7.711],\n                [-68.203, 13.923],\n                [-73.125, -9.102]\n              ]]}'\n# We can make the geojson a spatial object if we want to use the\n# functionality of the `sf` package.\nbrazil_sf <- geojsonsf::geojson_sf(brazil)\nbrazil_datasets <- get_datasets(loc = brazil_sf)\nbrazil_datasets"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we have an object called "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"brazil_datasets"}]},{"type":"text","value":" that contains "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"r length(brazil_datasets)"}]},{"type":"text","value":".  "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can plot these findings!"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"exercise","properties":{"id":"3","title":"get_downloads()"},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"complete record"}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"frontmatter":{"id":2,"title":"Module 2: Neotoma2 Core Commands","description":"This module will teach you how to organize your environments using conda","next":"/module3","prev":"/module1"}}},"pageContext":{"slug":"/module2"}},"staticQueryHashes":["1029480139","1771538597","3063084251","4240431937"]}